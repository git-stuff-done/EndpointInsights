<h2 mat-dialog-title>Configure Batch</h2>

<mat-dialog-content class="modal-body">
    <mat-tab-group [dynamicHeight]="true" animationDuration="200ms">
        <!-- NAME TAB -->
        <mat-tab label="Overview">
            <div class="tab-pane" *ngIf="!loading(); else loadingTpl">
                <form [formGroup]="form" class="form grid">

                    <!-- Overview Tab -->
                    <mat-form-field appearance="outline" class="full tight-field">
                        <mat-label>Application Name</mat-label>
                        <input matInput placeholder="e.g. Payments Service" formControlName="batchName" />
                        <button
                                mat-icon-button
                                matSuffix
                                (click)="saveTitle()"
                                [disabled]="form.controls.batchName.invalid"
                                aria-label="Save title">
                            <mat-icon>save</mat-icon>
                        </button>
                    </mat-form-field>

                    <!-- Test Count -->
                    <div class="kv">
                        <div class="label">Number of Tests</div>
                        <div class="value">
                        </div>
                    </div>
                </form>
            </div>
        </mat-tab>

        <!-- Schedule Tab -->
        <mat-tab label="Schedule">
            <form [formGroup]="form">
                <div class="schedule-container">
                    <div class="schedule-row">
                        <mat-form-field appearance="outline" class="tight-field">
                            <mat-label>Next Run (Date)</mat-label>
                            <input matInput [matDatepicker]="picker" formControlName="nextRunDate" />
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="tight-field">
                            <mat-label>Time</mat-label>
                            <input matInput type="time" placeholder="start time">
                        </mat-form-field>

                        <mat-button-toggle-group multiple class="schedule-day-container">
                            <mat-button-toggle value="sun" class="schedule-day">Sunday</mat-button-toggle>
                            <mat-button-toggle value="mon" class="schedule-day">Monday</mat-button-toggle>
                            <mat-button-toggle value="tue" class="schedule-day">Tuesday</mat-button-toggle>
                            <mat-button-toggle value="wed" class="schedule-day">Wednesday</mat-button-toggle>
                            <mat-button-toggle value="thu" class="schedule-day">Thursday</mat-button-toggle>
                            <mat-button-toggle value="fri" class="schedule-day">Friday</mat-button-toggle>
                            <mat-button-toggle value="sat" class="schedule-day">Saturday</mat-button-toggle>
                        </mat-button-toggle-group>
                    </div>
                    <div class="schedule-row">
                        <mat-label>Next Run: </mat-label>
                        <mat-label>Last Run: </mat-label>
                    </div>
                </div>
            </form>

        </mat-tab>

        <!-- Notifications Tab -->
        <mat-tab label="Notifications">
            <form [formGroup]="form">
                <div class="notification-container">
                    <div class="notification-sub-container search">
                        <mat-form-field appearance="outline">
                            <mat-label >Select Option</mat-label>
                            <div class="input-div">
                                <input matInput
                                       #participantInput
                                       [matAutocomplete]="auto"
                                       [formControl]="searchControl" />
                            </div>
                            <mat-autocomplete #auto="matAutocomplete"
                                              [displayWith]="displayParticipant"
                                              (optionSelected)="onParticipantSelected($event)"
                                              panelClass="participant-panel">
                                <mat-option *ngFor="let option of searchParticipants"
                                            [value]="option"
                                            class="data-row">
                                    <div class="notification-search-result">
                                        <span>{{ option.name }}</span>
                                        <span>{{ option.email }}</span>
                                        <span>{{ option.role }}</span>
                                    </div>
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                        <button class="add-button" (click)="addParticipant()">Add</button>
                    </div>

                    <div class="participants-title-container">
                        <h2>Active Participants:</h2>
                        <button mat-raised-button (click)="removeParticipant()">Remove Participants</button>
                    </div>
                    <div class="notification-sub-container">
                        <div class="participant-list">
                            <div class="participant-list-header">
                                <span class="col-name">Name</span>
                                <span class="col-email">Email</span>
                                <span class="col-position">Position</span>
                            </div>

                            <mat-selection-list #participantList>
                                @for (participant of activeParticipants(); track participant.id) {
                                    <mat-list-option [value]="participant">
                                        <div class="participant-card">
                                            <span class="col-name">{{ participant.name }}</span>
                                            <span class="col-email">{{ participant.email }}</span>
                                            <span class="col-position">{{ participant.role }}</span>
                                        </div>
                                    </mat-list-option>
                                }

                            </mat-selection-list>
                        </div>
                    </div>
                </div>
            </form>
        </mat-tab>
        <mat-tab label="Jobs"></mat-tab>

        <mat-tab label="Settings"></mat-tab>
    </mat-tab-group>

    <ng-template #loadingTpl>
        <div class="loading">Loadingâ€¦</div>
    </ng-template>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-stroked-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="primary" (click)="save()">Save</button>
</mat-dialog-actions>
